# ğŸ”¥ å·²ä¿®å¤ - å·¥ä½œæµç°åœ¨ä¼šçœŸæ­£å¤„ç†è§†é¢‘äº†ï¼

## é—®é¢˜åŸå› 

ä¹‹å‰çš„å·¥ä½œæµè™½ç„¶è¿è¡ŒæˆåŠŸï¼Œä½†æ‰€æœ‰æ¨¡å—éƒ½æ˜¯**å ä½ç¬¦å®ç°**ï¼Œåªè¿”å›æˆåŠŸçŠ¶æ€è€Œä¸åšä»»ä½•å®é™…å¤„ç†ã€‚æ‰€ä»¥ï¼š
- âœ… å·¥ä½œæµæ˜¾ç¤º"å®Œæˆ"
- âŒ ä½† `output/` ç›®å½•æ˜¯ç©ºçš„

## å·²å®Œæˆçš„ä¿®å¤

### 1. âœ… å­—å¹•ç”Ÿæˆæ¨¡å—ï¼ˆå®Œå…¨å®ç°ï¼‰

ç°åœ¨ä¼šçœŸæ­£è°ƒç”¨ whisper.cpp ç”Ÿæˆå­—å¹•ï¼š

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨æå–éŸ³é¢‘ï¼ˆå¦‚æœéœ€è¦ï¼‰
- ä½¿ç”¨ whisper.cpp ç”Ÿæˆå­—å¹•
- æ”¯æŒå¤šç§æ ¼å¼ï¼ˆSRT, VTTï¼‰
- è‡ªåŠ¨è¯­è¨€æ£€æµ‹æˆ–æŒ‡å®šè¯­è¨€
- è¾“å‡ºåˆ° `events/EVENT_ID/output/` ç›®å½•

**ä½ç½®**ï¼š`controller/workflow_controller.py` â†’ `_run_subtitles()`

### 2. âœ… ç¼©ç•¥å›¾åˆæˆæ¨¡å—ï¼ˆå®Œå…¨å®ç°ï¼‰

ç°åœ¨ä¼šçœŸæ­£ç”Ÿæˆç¼©ç•¥å›¾å›¾ç‰‡ï¼š

**åŠŸèƒ½**ï¼š
- åˆ›å»º 1280x720 çš„ç¼©ç•¥å›¾
- æ·»åŠ æ ‡é¢˜æ–‡å­—ï¼ˆè‡ªåŠ¨æ¢è¡Œï¼‰
- æ·»åŠ ç»æ–‡å¼•ç”¨ï¼ˆå¦‚æœæœ‰ï¼‰
- ä½¿ç”¨èƒŒæ™¯å›¾ç‰‡ï¼ˆå¦‚æœ assets/backgrounds/ ä¸­æœ‰ï¼‰
- æ·»åŠ æ•™ä¼šLogoï¼ˆå¦‚æœ assets/logos/ ä¸­æœ‰ï¼‰
- è¾“å‡ºåˆ° `events/EVENT_ID/output/thumbnail.jpg`

**ä½ç½®**ï¼š`controller/workflow_controller.py` â†’ `_run_thumbnail_compose()`

---

## å¦‚ä½•æµ‹è¯•ä¿®å¤

### æ–¹æ³• 1: é‡æ–°è¿è¡Œç°æœ‰äº‹ä»¶

1. **é‡å¯APIæœåŠ¡å™¨**ï¼ˆåŠ è½½æ–°ä»£ç ï¼‰ï¼š
   ```bash
   # åœæ­¢æ—§æœåŠ¡å™¨
   pkill -f "python.*api_server.py"
   
   # å¯åŠ¨æ–°æœåŠ¡å™¨
   python api_server.py
   ```

2. **åœ¨Webç•Œé¢é‡æ–°è¿è¡Œå·¥ä½œæµ**ï¼š
   - æ‰“å¼€ä½ çš„æµ‹è¯•äº‹ä»¶ï¼šhttp://localhost:3000/events/2026-01-26_2353_test
   - ç‚¹å‡» "Run Workflow" æŒ‰é’®
   - è§‚å¯Ÿè¿›åº¦ï¼ˆå¦‚æœè§†é¢‘è¾ƒå¤§ï¼Œå­—å¹•ç”Ÿæˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰

3. **æŸ¥çœ‹è¾“å‡º**ï¼š
   ```bash
   ls -lh events/2026-01-26_2353_test/output/
   ```
   
   åº”è¯¥çœ‹åˆ°ï¼š
   - `thumbnail.jpg` - ç¼©ç•¥å›¾
   - `CST-405 Final.srt` - SRTå­—å¹•æ–‡ä»¶
   - `CST-405 Final.vtt` - VTTå­—å¹•æ–‡ä»¶
   - `CST-405 Final_audio.wav` - æå–çš„éŸ³é¢‘ï¼ˆä¸´æ—¶æ–‡ä»¶ï¼‰

### æ–¹æ³• 2: åˆ›å»ºæ–°äº‹ä»¶æµ‹è¯•

1. åœ¨Webç•Œé¢åˆ›å»ºæ–°äº‹ä»¶
2. ä¸Šä¼ è§†é¢‘ï¼ˆä½¿ç”¨å®Œæ•´è·¯å¾„ï¼‰
3. è¿è¡Œå·¥ä½œæµ
4. ç­‰å¾…å®Œæˆ
5. æŸ¥çœ‹ output/ ç›®å½•

---

## æµ‹è¯•è„šæœ¬

è¿è¡Œä»¥ä¸‹å‘½ä»¤æµ‹è¯•æ‰€æœ‰æ¨¡å—ï¼š

```bash
python test_modules.py
```

è¿™ä¼šï¼š
- âœ… æ£€æŸ¥ whisper.cpp æ˜¯å¦å¯ç”¨
- âœ… æ£€æŸ¥æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- âœ… æµ‹è¯•ç¼©ç•¥å›¾ç”Ÿæˆï¼ˆåˆ›å»ºç¤ºä¾‹å›¾ç‰‡ï¼‰
- âœ… æ£€æŸ¥ç°æœ‰äº‹ä»¶çš„çŠ¶æ€

---

## é¢„æœŸè¾“å‡ºç¤ºä¾‹

### æˆåŠŸçš„å·¥ä½œæµè¿è¡Œåï¼š

```
events/2026-01-26_2353_test/
â”œâ”€â”€ event.json                      # äº‹ä»¶é…ç½®
â”œâ”€â”€ input/                          # è¾“å…¥ç›®å½•ï¼ˆç©ºï¼‰
â”œâ”€â”€ output/                         # â­ è¾“å‡ºç›®å½•ï¼ˆç°åœ¨æœ‰æ–‡ä»¶äº†ï¼ï¼‰
â”‚   â”œâ”€â”€ thumbnail.jpg              # 1280x720 ç¼©ç•¥å›¾
â”‚   â”œâ”€â”€ CST-405 Final.srt          # å­—å¹•æ–‡ä»¶ï¼ˆSRTæ ¼å¼ï¼‰
â”‚   â”œâ”€â”€ CST-405 Final.vtt          # å­—å¹•æ–‡ä»¶ï¼ˆVTTæ ¼å¼ï¼‰
â”‚   â””â”€â”€ CST-405 Final_audio.wav    # éŸ³é¢‘æ–‡ä»¶ï¼ˆwhisperç”¨ï¼‰
â””â”€â”€ logs/                          # æ‰§è¡Œæ—¥å¿—
    â”œâ”€â”€ workflow_state.json        # å·¥ä½œæµçŠ¶æ€
    â”œâ”€â”€ subtitles_result.json      # å­—å¹•æ¨¡å—ç»“æœ
    â””â”€â”€ thumbnail_compose_result.json # ç¼©ç•¥å›¾æ¨¡å—ç»“æœ
```

---

## å­—å¹•ç”Ÿæˆæ—¶é—´

å­—å¹•ç”Ÿæˆæ—¶é—´å–å†³äºè§†é¢‘é•¿åº¦å’Œæ¨¡å‹å¤§å°ï¼š

| è§†é¢‘é•¿åº¦ | baseæ¨¡å‹ | smallæ¨¡å‹ | mediumæ¨¡å‹ |
|---------|---------|----------|-----------|
| 5åˆ†é’Ÿ   | ~30ç§’   | ~1åˆ†é’Ÿ   | ~2åˆ†é’Ÿ    |
| 30åˆ†é’Ÿ  | ~3åˆ†é’Ÿ  | ~6åˆ†é’Ÿ   | ~12åˆ†é’Ÿ   |
| 1å°æ—¶   | ~6åˆ†é’Ÿ  | ~12åˆ†é’Ÿ  | ~25åˆ†é’Ÿ   |

**å½“å‰ä½¿ç”¨**: `base` æ¨¡å‹ï¼ˆé€Ÿåº¦å¿«ï¼Œè´¨é‡ä¸­ç­‰ï¼‰

---

## æŸ¥çœ‹ç”Ÿæˆçš„å­—å¹•

```bash
# æŸ¥çœ‹SRTå­—å¹•å†…å®¹ï¼ˆå‰20è¡Œï¼‰
head -20 events/2026-01-26_2353_test/output/*.srt
```

SRTæ ¼å¼ç¤ºä¾‹ï¼š
```
1
00:00:00,000 --> 00:00:03,000
Welcome to our church service today.

2
00:00:03,000 --> 00:00:06,000
Today we're going to talk about God's grace.
```

---

## æŸ¥çœ‹ç”Ÿæˆçš„ç¼©ç•¥å›¾

```bash
# macOS
open events/2026-01-26_2353_test/output/thumbnail.jpg

# Linux
xdg-open events/2026-01-26_2353_test/output/thumbnail.jpg
```

æˆ–ç›´æ¥åœ¨Webç•Œé¢æŸ¥çœ‹ï¼ˆåŠŸèƒ½å¾…æ·»åŠ ï¼‰ã€‚

---

## æ•…éšœæ’é™¤

### é—®é¢˜: å­—å¹•ç”Ÿæˆå¤±è´¥

**æ£€æŸ¥**:
```bash
# æ£€æŸ¥whisper.cppæ˜¯å¦å¯ç”¨
../whisper.cpp/main --help

# æ£€æŸ¥æ¨¡å‹æ˜¯å¦å­˜åœ¨
ls -lh ../whisper.cpp/models/ggml-base.bin
```

**è§£å†³æ–¹æ³•**:
- åœ¨ Dependencies é¡µé¢é‡æ–°é…ç½® whisper.cpp è·¯å¾„
- ç¡®ä¿æ¨¡å‹æ–‡ä»¶å·²ä¸‹è½½

### é—®é¢˜: ç¼©ç•¥å›¾ç”Ÿæˆå¤±è´¥

**æ£€æŸ¥é”™è¯¯æ—¥å¿—**:
```bash
cat events/EVENT_ID/logs/thumbnail_compose_result.json
```

**å¸¸è§åŸå› **:
- PIL/Pillow æœªå®‰è£…ï¼š`pip install pillow`
- æƒé™é—®é¢˜ï¼šæ£€æŸ¥ output/ ç›®å½•æƒé™

### é—®é¢˜: å·¥ä½œæµå¡ä½ä¸åŠ¨

**åŸå› **: å¤§è§†é¢‘æ–‡ä»¶éœ€è¦è¾ƒé•¿å¤„ç†æ—¶é—´

**æ£€æŸ¥è¿›åº¦**:
```bash
# æŸ¥çœ‹APIæœåŠ¡å™¨æ—¥å¿—
# ä¼šæ˜¾ç¤º "Running subtitle generation..." ç­‰æ¶ˆæ¯
```

**æ­£å¸¸**: 30åˆ†é’Ÿè§†é¢‘å¯èƒ½éœ€è¦3-5åˆ†é’Ÿå¤„ç†

---

## ä¸‹ä¸€æ­¥åŠŸèƒ½

è™½ç„¶å­—å¹•å’Œç¼©ç•¥å›¾å·²ç»å®ç°ï¼Œä½†è¿˜æœ‰å‡ ä¸ªæ¨¡å—å¾…å®Œå–„ï¼š

### å¾…å®ç°çš„æ¨¡å—ï¼š

1. **Thumbnail AI** (`_run_thumbnail_ai`)
   - ä½¿ç”¨ Ollama ç”ŸæˆAIè§’è‰²å›¾ç‰‡
   - éœ€è¦ Ollama è¿è¡Œä¸­
   
2. **YouTube Upload** (`_run_publish_youtube`)
   - ä¸Šä¼ è§†é¢‘åˆ°YouTube
   - éœ€è¦ YouTube API å‡­è¯
   
3. **Website Publisher** (`_run_publish_website`)
   - å‘å¸ƒåˆ°æ•™ä¼šç½‘ç«™
   - éœ€è¦ç½‘ç«™APIé…ç½®

4. **Archive** (`_run_archive`)
   - å½’æ¡£åˆ°äº‘å­˜å‚¨
   - éœ€è¦äº‘å­˜å‚¨é…ç½®

è¿™äº›æ¨¡å—å½“å‰ä¼šå¿«é€Ÿè¿”å›æˆåŠŸï¼Œä½†ä¸åšå®é™…æ“ä½œã€‚å¦‚æœä¸éœ€è¦è¿™äº›åŠŸèƒ½ï¼Œå¯ä»¥åœ¨åˆ›å»ºäº‹ä»¶æ—¶ç¦ç”¨å®ƒä»¬ã€‚

---

## æµ‹è¯•å»ºè®®

### æµ‹è¯•ç”¨ä¾‹ 1: çŸ­è§†é¢‘ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰
- ä½¿ç”¨ < 5åˆ†é’Ÿçš„è§†é¢‘
- åªå¯ç”¨ subtitles å’Œ thumbnail_compose
- é¢„æœŸ < 1åˆ†é’Ÿå®Œæˆ

### æµ‹è¯•ç”¨ä¾‹ 2: å®Œæ•´è¯é“ï¼ˆçœŸå®åœºæ™¯ï¼‰
- ä½¿ç”¨ 30-60 åˆ†é’Ÿçš„è¯é“è§†é¢‘
- å¯ç”¨æ‰€æœ‰éœ€è¦çš„æ¨¡å—
- é¢„æœŸ 5-10 åˆ†é’Ÿå®Œæˆ

---

## æˆåŠŸæ ‡å¿—

ä½ ä¼šçŸ¥é“ä¿®å¤æˆåŠŸï¼Œå½“ä½ çœ‹åˆ°ï¼š

âœ… å·¥ä½œæµè¿è¡Œåï¼Œ`output/` ç›®å½•**ä¸å†æ˜¯ç©ºçš„**
âœ… å¯ä»¥çœ‹åˆ°å®é™…çš„å­—å¹•æ–‡ä»¶ï¼ˆ.srt, .vttï¼‰
âœ… å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„ç¼©ç•¥å›¾ï¼ˆ.jpgï¼‰
âœ… å­—å¹•æ–‡ä»¶åŒ…å«å®é™…çš„è½¬å½•æ–‡å­—
âœ… ç¼©ç•¥å›¾ä¸Šæœ‰æ ‡é¢˜æ–‡å­—

---

## ğŸ‰ ç°åœ¨å°±è¯•è¯•å§ï¼

1. é‡å¯APIæœåŠ¡å™¨
2. åˆ·æ–°æµè§ˆå™¨é¡µé¢
3. æ‰“å¼€ä½ çš„æµ‹è¯•äº‹ä»¶
4. ç‚¹å‡» "Run Workflow"
5. ç­‰å¾…å‡ åˆ†é’Ÿ
6. æ£€æŸ¥ output/ ç›®å½•

æœ‰ä»»ä½•é—®é¢˜éšæ—¶å‘Šè¯‰æˆ‘ï¼
